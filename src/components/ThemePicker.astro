---
import ButtonFooter from './button/ButtonFooter.astro';
import IconComputer from './icons/IconComputer.astro';
import IconMoon from './icons/IconMoon.astro';
import IconSun from './icons/IconSun.astro';
---

<ButtonFooter id="themeSelectDark">
  <IconMoon />
  MÃ¸rkt
</ButtonFooter>

<ButtonFooter id="themeSelectLight">
  <IconSun />
  Lyst
</ButtonFooter>

<ButtonFooter id="themeSelectSystem">
  <IconComputer />
  System
</ButtonFooter>

<script>
  const onThemeChange = () => {
    const isDark =
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) &&
        window.matchMedia('(prefers-color-scheme: dark)').matches);

    if (isDark) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };

  const lightThemeButton = document.querySelector('#themeSelectLight');
  const darkThemeButton = document.querySelector('#themeSelectDark');
  const systemThemeButton = document.querySelector('#themeSelectSystem');
  const mediaQueryList = window.matchMedia('(prefers-color-scheme: dark)');

  lightThemeButton &&
    lightThemeButton.addEventListener('click', () => {
      localStorage.theme = 'light';
      onThemeChange();
    });

  darkThemeButton &&
    darkThemeButton.addEventListener('click', () => {
      localStorage.theme = 'dark';
      onThemeChange();
    });

  systemThemeButton &&
    systemThemeButton.addEventListener('click', () => {
      localStorage.removeItem('theme');
      onThemeChange();
    });

  mediaQueryList.addEventListener('change', (e) => {
    onThemeChange();
  });
</script>
